---
title: "ETC5521 Assignment 1"
author:
- Dea Avega Editya
- Siyi Li
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document2: default
  pdf_document2: default
  html_document:
    df_print: paged
team: Quokka
subtitle: ''
bibliography: references.bib
---

[This assignment is for ETC5521 Assignment 1 by Team `r rmarkdown::metadata$team` comprising of `r knitr::combine_words(rmarkdown::metadata$author)`.]{style="color:#006DAE;"}

```{r read-data, echo = FALSE, include = FALSE,  results="hide", message = FALSE}

knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(janitor)
library(readr)
library(naniar)
library(dplyr)
library(gridExtra)
library(ggpubr)
library(reshape2)
library(tidytext)
library(lubridate)
library(plotly)

# Get the Data

blackpast <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-16/blackpast.csv')
census <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-16/census.csv')
slave_routes <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-16/slave_routes.csv')
african_names <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-16/african_names.csv')

sum(is.na(slave_routes))

#checking missing values (NA)
naniar::miss_summary(slave_routes)
naniar::miss_summary(african_names)

#summary
summary(slave_routes)
summary(african_names)

```


# Introduction and motivation

We are motivated to explore history of slavery in the United States of America (USA) and how this dark moment changed over time of hundred years. Through the data that sourced from tidytuesday github (https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-06-16/readme.md), we will look at how the situation at the moment was and what can we learn from the history that maybe has correlation with current racist behavior toward black people especially in the USA. 

This report has several limitations: 
\newline 1. Several datasets used are only approximation of total number, i.e. route of slaves transportation is based on approximation inferred from all trans-Atlantic voyages records, and slaves names data only covers numbers of slaves who had been saved during expedition. Hence, it may not capture real situation during slavery history.
\newline 2. Census data only capture US demographics from 1790 to 1870 which is quite short regarding long existence of slavery before the census period. In addition, West region only has census data started from 1850.
\newline 3. Some proportion of data has N/A value and errors (i.e. some slaves' heights are recorded as 0 inch) which maybe ignored during data exploration. 

# Data description

<!-- Write your data description under the header “Data description” in index.Rmd. A data description should tell the reader the source of the data, and detail the structure of the data, including variables, time frame of collection, collection methods. -->

Our datasets are retrieved from github repository of **tidytuesday** project, which has original source from US Census's Archives, Slave Voyages, and Black Past. 

The data consists of 4 datasets as follows:

1. Census (in csv format)
  The dataset record the total slave populations across the USA during the slavery era and has 8 variables (region, division, year, total, white, black, black_free and black_slave) and 102 observation. The data is collected from a historical US census data with time period from 1790 to 1870. 

2. Slave_routes (in csv format) 
  The dataset has 8 variables (voyage_id, ship_name, port_origin, place_of_purchase, port_arrival, year_arrival, n_slaves_arrived, and captains_name) and 31.660 observations. The data is collected by approximating the total number of voyages carrying slaves from Africa, inferred from the 36,000 trans-Atlantic voyages logs. It covers information about transportation of slaves from 1514 to 1866.
  
3. African_names (in csv format)
  The dataset has 11 variables (id, voyage id , name, gender, age, height, ship name, year arrival, port embark, and country origin) and 91.490 observations. The data is collected from liberated slaves by recording their names and ages. The record is from 1808 to 1862.

4. Blackpast (in csv format)
  The dataset covers details around some events related to African-Americas history during slavery era until post-slavery including violence and racism events and celebrations of achievements. It has 6 variables (year, event, subject, country, state and era) and 896 observations. The data is compiled by blackpast organization (blackpast.org) from 1492 to 2009.

The wrangling process will be conducted by combining  datasets of african_names and slave_routes by using "voyage_id" as key variable. In addition, this report will track slavery population in the USA based on census dataset, including average proportion of white and black slavery as well as proportion of free black and black slaves in US regions. The blackpast dataset can be used to add some detail information about particular events that maybe found interesting during data exploration.

Therefore, using these mentioned datasets this report may find explanations on a main question and three secondary questions. 
The primary question is **does the long slavery history in the USA explain current racism trend in the country**? 

This primary question can be found after answering several secondary questions which are:
1. What is the demographic of slaves? 
2. Which regions of the USA that had mostly exploited the practice? 
3. Which regions of the USA that most challenging for african-americans?

References:
1. Tidytuesday (https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-06-16/readme.md),
2. Slaves voyage (https://slavevoyages.org/)
3. Blackpast (https://www.blackpast.org/african-american-history-timeline/)
3. US census data (https://www.census.gov/content/dam/Census/library/working-papers/2002/demo/POP-twps0056.pdf)

# Analysis and findings

## Demographic of Black Slaves

Using african_names dataset we try to extract information about demographic of slaves. By looking at the dataset, we can have initial picture of the slavery practice. We group the category of slaves by id (since we are not interested to know their names and sometimes people can have same names), gender and age. 

We can get information about gender category from pie chart of figure \@ref(figure:demo1). As we can see that men occupies the largest percentage of total slaves in the observed data, followed by boys. Proportion of boys is also larger than women. Meanwhile, girls contributes to the smallest percentage of slaves. Hence, from the figure we can see that men and boys' proportion are significantly larger than female (women and girls). However, we realize that if we look at children proportion (boys and girls) as shown in figure \@ref(figure:demo), it is really sad to know that they make up about a half of the total slaves. 

When we look at the age distribution of slaves as shown in figure \@ref(figure:demo2), majority of the slaves are between **15 and 35 years old**. This is because people in this age tend to more productive, as they were brought to be workers in the country according to prior information we got from blackpast.org. 

Though, there are some outliers in the dataset which we suspect due to errors in data recording i.e. a boy has age of 40 and man with 77 years old (which we think is too old to be a slave). Another finding is there are some slaves that just age 5 months old as well as under 5 years old. They are absolutely pretty young. One possible reason is that their parents are one of the slaves hence brought along with them.

```{r demo, fig.caption= "Maturity of Slaves", echo = FALSE, warning = FALSE, out.height="60%", out.width="60%",message=FALSE}
african_names %>%
  select(id, gender, age)%>%
  na.omit()%>%
  group_by(gender)%>%
  count()%>%
  mutate(total=n)%>%
  select(-n)%>%
  as_tibble()-> new

 new_type<-rbind(new, c("children", colSums(new[1:2,2])),
                 c("Adults", colSums(new[3:4,2])))
 
 target<-c("children","Adults")
filter(new_type, gender %in% target)%>%
   ggplot(aes(x=gender,y= total, fill=factor(gender)))+
  geom_bar(stat="identity",position="dodge")+
  xlab("Type")+ylab("Number")+
  labs(fill = "Maturity")
 
  
```


```{r demo1, out.height="100%", out.width="100%", echo = FALSE}

new_plty<-plot_ly(new, labels = ~gender, values = ~total, type ='pie', width = 400, height = 200)
new_plty %>% layout(title='The number of ench gender',
                    xaxis=list(showgrid=FALSE, zeroline=FALSE, showticklabels=FALSE),
                    yaxis=list(showgrid=FALSE, zeroline=FALSE, showticklabels=FALSE))

```


```{r demo2, fig.caption = "Age Distribution of Slaves", echo = FALSE, out.height="100%", out.width="100%", message=FALSE}
african_names%>%
  select(gender, age)%>%
  na.omit()%>%
  arrange(desc(-age))->afrian_new


  plot_ly(type = "box",
          x=~age,
          y=~gender,
          color=~gender,
          data=afrian_new) %>% 
    layout(title="Age of different gender",
         yaxis=list(title="",
                      zeroline=FALSE),
         xaxis=list(title="Age",
                      zeroline=FALSE))
```


```{r join_slave, echo = FALSE, include = FALSE,  results="hide", message = FALSE}

slave_join <- left_join(slave_routes, african_names, by = "voyage_id")

# visualize missing value
naniar::vis_miss(slave_join, warn_large_data = FALSE)


```


## The most exploiting region in the USA


```{r region_census, echo = FALSE, include = FALSE,  results="hide", message = FALSE}

census_prop <- census %>% 
  mutate(prop_white = white/total, prop_black = black/total, prop_black_free = black_free/black, prop_black_slave = black_slaves/black)

# ploting US  
US <- census %>% 
  slice(1:9)

US %>% 
  group_by(region, year) %>% 
  ggplot(aes(x = year))+
  geom_line(aes(y = black_slaves))+
  geom_line(aes(y = black_free), color = "green")+
  geom_line(aes(y = white), color = "red")


# Deleting 1870 since there is no slavery in that year due to regulation
state <- census_prop %>% 
  slice(10:38) %>% 
  filter(year != 1870)
  

# Regions
S <- state %>% 
  filter(region == "South") %>% 
  ggplot(aes(x = year))+
  geom_line(aes(y = black_slaves, color = "black_slaves"), size = 2)+
  geom_line(aes(y = white, color = "white"), size = 1.5)+
  geom_line(aes(y = black_free, color = "black_free"), size = 1.5)+
  ggtitle("South")+
  ylab("count")+
  scale_color_manual(values = c('black_slaves'='black','white'='red', "black_free" = "green"))+
  scale_y_continuous(labels = scales::label_comma())+
  labs(color = "category")
  
N <- state %>% 
  filter(region == "Northeast") %>% 
  ggplot(aes(x = year))+
  geom_line(aes(y = black_slaves, color = "black_slaves"), size = 2)+
  geom_line(aes(y = white, color = "white"), size = 1.5)+
  geom_line(aes(y = black_free, color = "black_free"), size = 1.5)+
  ggtitle("Northeast")+
  ylab("count")+
  scale_color_manual(values = c('black_slaves'='black','white'='red', "black_free" = "green"))+
  scale_y_continuous(labels = scales::label_comma())+
  labs(color = "category")
  
M <- state %>% 
  filter(region == "Midwest") %>% 
  ggplot(aes(x = year))+
  geom_line(aes(y = black_slaves, color = "black_slaves"), size = 2)+
  geom_line(aes(y = white, color = "white"), size = 1.5)+
  geom_line(aes(y = black_free, color = "black_free"), size = 1.5)+
  ggtitle("Midwest")+
  ylab("count")+
   scale_color_manual(values = c('black_slaves'='black','white'='red', "black_free" = "green"))+
  scale_y_continuous(labels = scales::label_comma())+
  labs(color = "category")
 
## west only has two years (1860, 1850)
W <- state %>% 
  filter(region == "West") %>% 
  ggplot(aes(x = year))+
  geom_line(aes(y = black_slaves, color = "black_slaves"), size = 2)+
  geom_line(aes(y = white, color = "white"), size = 1.5)+
  geom_line(aes(y = black_free, color = "black_free"), size = 1.5)+
  ggtitle("West")+
  ylab("count")+
  scale_color_manual(values = c('black_slaves'='black','white'='red', "black_free" = "green"))+
  scale_y_continuous(labels = scales::label_comma())+
  labs(color = "category")

```

```{r compare-region, fig.align="center", echo = FALSE}
ggarrange(N, M, S, W,
          ncol = 2, nrow = 2, common.legend = TRUE, legend = "bottom")
```

For answering this question, we will not look at the number of black slaves in each region. Instead, we will see the trend composition of these three categories, as seen in figure \@ref(figure:compare-region).

According to the plot, South region has the most contrast pattern which distinguish the region from others. The population of white is increasing from 1800 up to 1860 just like what occurs in other regions. The different here is that black slaves also grows following the rise in population of white people.

```{r south_div, echo = FALSE, include = FALSE,  results="hide", message = FALSE}
# which division of south?
census
SA <- census %>% 
  filter(year != 1870, region == "South", division == "South Atlantic") %>% 
  ggplot(aes(x = year))+
  geom_line(aes(y = black_slaves), size = 2)+
  geom_line(aes(y = white), color = "red", size = 1.5)+
  geom_line(aes(y = black_free), color = "green", size = 1.5)+
  ggtitle("South Atlantic")+
  ylab("count")+
  theme_minimal()

ES <- census %>% 
  filter(year != 1870, region == "South", division == "East South Central") %>% 
  ggplot(aes(x = year))+
  geom_line(aes(y = black_slaves), size = 2)+
  geom_line(aes(y = white), color = "red", size = 1.5)+
  geom_line(aes(y = black_free), color = "green", size = 1.5)+
  ggtitle("East South Central")+
  ylab("count")+
  theme_minimal()

WS <- census %>% 
  filter(year != 1870, region == "South", division == "West South Central") %>% 
  ggplot(aes(x = year))+
  geom_line(aes(y = black_slaves), size = 2)+
  geom_line(aes(y = white), color = "red", size = 1.5)+
  geom_line(aes(y = black_free), color = "green", size = 1.5)+
  ggtitle("West South Central")+
  ylab("count")+
  theme_minimal()

```

```{r south_all, fig.align="center", out.height="60%", out.width="60%", echo = FALSE, message = FALSE}

ggarrange(SA, ES, WS,
          ncol = 1, nrow = 3, legend = "top", common.legend = TRUE)
```


# The most challenging region for African-Americans

In this section, we will look at some unfortunate events that was happenned in the pas using data from blakcpast dataset. For the purpose, we will filter country of interest to be only the USA.

```{r event, echo = FALSE, include = FALSE,  results="hide", message = FALSE}
# select bad events in the US black history
# we assign corresponding regions to each state so we can check our previous exploration in most exploiting regions
blackpast_usa <- blackpast %>% 
  filter(country == "United States") %>% 
  filter(subject %in% c("Slave Laws", "Slave Labor", "Racial Restrictions",
          "Racial Violence","Resistance to Enslavement",
          "The Slavery Controversy","Antebellum Slavery")) %>%       
  mutate(region = case_when(
        state %in% c("Connecticut", "Maine", "Massachusetts", "New Hampshire", "Rhode Island", "Vermont", "New York", "New Jersey", "Pennsylvania") ~ "Northeast",
        state %in% c("Illinois", "Indiana", "Michigan", "Ohio", "Wisconsin", "Iowa", "Kansas", "Minnesota", "Missouri", "Nebraska", "North Dakota", "South Dakota") ~ "Midwest",
        state %in% c() ~ "",
        state %in% c("Delaware", "Florida", "Georgia", "Maryland", "North Carolina", "South Carolina", "Virginia", "District of Columbia", "West Virginia", "Alabama", "Kentucky", "Mississippi", "Tennessee", "Arkansas", "Louisiana", "Oklahoma", "Texas") ~ "South",
        state %in% c("Arizona", "Colorado", "Idaho", "Montana", "Nevada", "New Mexico", "Utah", "Wyoming", "Alaska", "California", "Hawaii", "Oregon", "Washington") ~ "West",
              ))

```

```{r sentiment, echo = FALSE, message = FALSE}

# using nrc package for analyse negative sentiment
nrc_sentiments <- get_sentiments("nrc") %>% 
  filter(sentiment %in% c("trust", "fear", "anger", "negative"))

text_blackpast <- blackpast_usa %>% 
  select(events, region) %>% 
  ungroup() %>% 
  unnest_tokens(input = "events", token = "words", "word")

# remove unnecessary words
data("stop_words")

text_tidy <- text_blackpast %>% 
  anti_join(stop_words)

text_tidy <- left_join(text_tidy, nrc_sentiments) %>% 
  na.omit()

# # removing word white, black, police, church, mob
# neutral <- c("white", "black", "police", "church", "mob")
# 
# # text_tidy <- text_tidy %>% 
# #   count(word, sort = TRUE) %>%
# #   filter(n > 10) %>%
# #   filter(!word %in% neutral) %>% 
# #   mutate(word = reorder(word, n)) %>%
# #   ggplot(aes(sentiment, n)) +
# #   geom_col() +
# #   xlab(NULL) +
# #   coord_flip()
# 
# plot_sentiment <- text_tidy %>% 
#   count(sentiment, sort = TRUE) %>%
#   filter(n > 1) %>%
#   mutate(sentiment = reorder(sentiment, n)) %>%
#   ggplot(aes(x = sentiment, y = n)) +
#   geom_col() +
#   xlab(NULL) +
#   coord_flip()
# 
# plot_sentiment


```

```{r sentiment_region, echo = FALSE, message = FALSE, fig.align="center", out.height="50%", out.width="50%"}
plot_sentiment2 <- text_tidy %>% 
  ggplot(aes(x = sentiment, y = word, fill= region, group = region)) +
  geom_col() +
  xlab("") +
  ylab("")+
  coord_flip()+
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())

plot_sentiment2

```

```{r sentiment_negative, fig.align="center", echo = FALSE, message = FALSE, out.height="50%", out.width="50%"}

# only bad sentiment analysed
plot_sentiment3 <- text_tidy %>% 
  filter(sentiment %in% c("negative", "fear", "disgust", "sadness")) %>% 
  ggplot(aes(x = region, y = word, fill = sentiment, group = sentiment)) +
  geom_col() +
  xlab("") +
  ylab("")+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

plot_sentiment3
```


Using these method, we can extract several high frequent bad events for black people in USA. According to the analysis in figure \@ref(figure:sentiment_region), most nuance of events are **negative, fear and anger**. Furthermore, most events recorded were occured in South region. It is not surprising given the previous finding that South region is a region that seems really exploiting slavery culture. 

We then focus on particular bad events which represented by nuance of disgust, fear, negative and sadness. Using these sentiments, we can see and confirm that South and Northeast region contributed to unfortunate events for black people. On the other hand, **West region** maybe a good place to live for them, due to very few bad incidents happened there.

## Summary

The history of slavery has deeply rooted in some parts of the USA, particularly in South region. The slaves were brought into the country mainly for being workers, therefore the majority of slaves are **15 years old and 35 years old** 

According to sentiment analysis from blackpast record of events, we can see that most bad events took place in South region followed by Northeast region. This finding coincidentally match with a 2015 research of @journal that describes these two regions as the most racist regions in the United States, by calculating number of google searches in the country that contain the N-word. 
(https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0122963#pone.0122963.ref001) 

## Bibliography
