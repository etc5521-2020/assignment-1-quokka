---
title: "ETC5521 Assignment 1"
author:
- Dea Avega Editya
- Siyi Li
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
  pdf_document: default
team: Quokka
subtitle: Unboxing the Dark History of US Slavery
bibliography: references.bib
nocite: |
  @tidyverse, @janitor, @readr, @naniar, @dplyr, @gridextra, @ggpubr, @reshape, @lubridate, @plotly, @ggthemes
---

[This assignment is for ETC5521 Assignment 1 by Team `r rmarkdown::metadata$team` comprising of `r knitr::combine_words(rmarkdown::metadata$author)`.]{style="color:#006DAE;"}

```{r read-data, echo = FALSE, include = FALSE,  results="hide", message = FALSE}

knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(janitor)
library(readr)
library(naniar)
library(dplyr)
library(gridExtra)
library(ggpubr)
library(reshape2)
library(tidytext)
library(lubridate)
library(plotly)
library(ggthemes)

# Get the Data

blackpast <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-16/blackpast.csv')
census <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-16/census.csv')
slave_routes <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-16/slave_routes.csv')
african_names <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-16/african_names.csv')

sum(is.na(slave_routes))

#checking missing values (NA)
naniar::miss_summary(slave_routes)
naniar::miss_summary(african_names)

#summary
summary(slave_routes)
summary(african_names)

```


# Introduction and motivation

We are motivated to explore history of slavery in the United States of America (USA) and how this dark moment changed over time of hundred years. Through the data that sourced from tidytuesday github (https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-06-16/readme.md), we will look at how the situation at the moment was and what can we learn from the history that maybe has correlation with current racist behavior toward black people especially in the USA. 

This report has several limitations: 
\newline 1. Data sets used only contain relatively small observations, i.e. slaves_name record only covers numbers of slaves saved during their expedition. Hence, it may not capture real situation during slavery history.
\newline 2. Census data only capture US demographics from 1790 to 1870 which is quite short regarding long existence of slavery prior to the census period. In addition, West region only has census data of 1850 and 1860.
\newline 3. Some proportion of data has N/A value and errors which maybe omitted during data exploration. 

# Data description

Our data sets are retrieved from github repository of **tidytuesday** project, which has original source from US Census's Archives, Slave Voyages, and Black Past. 

There are four data sets in the tidytuesday's repo, however for this report's purpose we only use three data sets which are:

1. Census (in csv format)
  The data set record the total slave populations across the USA during the slavery era and has 8 variables (region, division, year, total, white, black, black_free and black_slave) and 102 observation. The data is collected from a historical US census data with time period from 1790 to 1870. 
  
2. African_names (in csv format)
  The data set has 11 variables (id, voyage id , name, gender, age, height, ship name, year arrival, port embark, and country origin) and 91.490 observations. The data is collected from liberated slaves by recording their names and ages. The record is from 1808 to 1862.

3. Blackpast (in csv format)
  The data set covers details around some events related to African-Americans history during slavery era until post-slavery including violence and racism events and celebrations of achievements. It has 6 variables (year, event, subject, country, state and era) and 896 observations. The data is compiled by blackpast organization (blackpast.org) from 1492 to 2009.

The wrangling process is conducted by grouping some variables in the african_names to have aggregate number of each category hence enable us to compare across categories. We also recalculate number of total population in census data since the existing number is incorrect for some region i.e. West region (we find this miscalculation after visualizing the data). These proportions will be used to track slavery exploitation in the USA.

Furthermore, this report also takes advantage of quite comprehensive record of African-Americans' events in the blackpast data set, to analyze which region of USA that seems to be unfriendly to the African-American people related to the negative sentiments observed.

Therefore, using all of these mentioned datasets this report may find some brief explanations on a main question: **Does the long slavery history in the USA explain current racism towards African-American**? 

In order to answer the main question, we will first look at these secondary questions:
1. What is the demographic of black slaves? 
2. Which region of the USA that had mostly exploited the practice? 
3. Which region is the most unfriendly for black people?

References of data sets:
\newline 1. Tidytuesday (https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-06-16/readme.md),
2. Blackpast (https://www.blackpast.org/african-american-history-timeline/)
3. US census data (https://www.census.gov/content/dam/Census/library/working-papers/2002/demo/POP-twps0056.pdf)

# Analysis and findings

## Demographic of Black Slaves


```{r demo, fig.cap = "Maturity of Slaves", echo = FALSE, warning = FALSE, out.height="60%", out.width="60%",fig.align = "center", message=FALSE}
african_names %>%
  select(id, gender, age)%>%
  na.omit()%>%
  group_by(gender)%>%
  count()%>%
  mutate(total=n)%>%
  select(-n)%>%
  as_tibble()-> new

 new_type<-rbind(new, c("children", colSums(new[1:2,2])),
                 c("Adults", colSums(new[3:4,2])))
 
 target<-c("children","Adults")
filter(new_type, gender %in% target)%>%
   ggplot(aes(x=gender,y= total, fill=factor(gender)))+
  geom_bar(stat="identity",position="dodge")+
  xlab("Type")+ylab("Number")+
  labs(fill = "Maturity")
 
  
```


```{r demo1, fig.cap="Composition Based on Gender", out.height="100%", out.width="60%", fig.align="center", echo = FALSE}

new_plty<-plot_ly(new, labels = ~gender, values = ~total, type ='pie', width = 400, height = 200)
new_plty %>% layout(title='Composition of Slaves Based on Gender',
                    xaxis=list(showgrid=FALSE, zeroline=FALSE, showticklabels=FALSE),
                    yaxis=list(showgrid=FALSE, zeroline=FALSE, showticklabels=FALSE))

```


```{r demo2, fig.cap = "Age Distribution", echo = FALSE, out.height="100%", out.width="100%", message=FALSE}
african_names%>%
  select(gender, age)%>%
  na.omit()%>%
  arrange(desc(-age))->afrian_new


  plot_ly(type = "box",
          x=~age,
          y=~gender,
          color=~gender,
          data=afrian_new) %>% 
    layout(title="Age of different gender",
         yaxis=list(title="",
                      zeroline=FALSE),
         xaxis=list(title="Age",
                      zeroline=FALSE))
```

In this section, we will extract some information from african_names dataset related to demographic of slaves. By extracting and analyzing the data, we can have initial picture of the slavery practice before moving on to further analysis in the following sections. We group the category of slaves by **id** (since we are not interested to know their names and sometimes people can have similar names), **gender** and **age**. 

Thus, we can get information about gender category from a pie chart of figure \@ref(fig:demo1). As can be seen from the plot, that men occupy the largest percentage of total slaves in the observed data, followed by boys. Proportion of boys is also larger than women. Meanwhile, girls contribute to the smallest percentage of slaves. In general, we can see that men and boys' proportion are significantly larger than female (women and girls). However, we realize that if we look at children proportion (boys and girls) as shown in figure \@ref(figure:demo), it is really sad to know that they make up almost a half of the total slaves. 

When we look at the age distribution of slaves as shown in figure \@ref(fig:demo2), majority of the slaves are between **15 and 35 years old**. This range of productive ages is unsurprising because they were brought into the country mainly to be a worker, according to prior information we got from blackpast.org. 

Though, there are some outlier that we can spot from the figure \@ref(fig:demo2) which we suspect due to errors in data recording i.e. a boy has age of 40 and a man is 77 years old (which we think way too old to be a slave). Another finding is there are some slaves that just age 5 months old as well as some children under 5 years old, which are absolutely pretty young. One possible reason is that their parents are among the slaves that brought along their children.

## The most exploiting region in the USA


```{r region_census, echo = FALSE, message = FALSE}


# # ploting US  
# US <- census %>% 
#   slice(1:9)
# 
# US %>% 
#   group_by(region, year) %>% 
#   ggplot(aes(x = year))+
#   geom_line(aes(y = black_slaves))+
#   geom_line(aes(y = black_free), color = "green")+
#   geom_line(aes(y = white), color = "red")


# Deleting 1870 since there is no slavery in that year due to regulation
census_tidy <- census %>%
  slice(10:38) %>% 
  filter(year != 1870) %>% 
  mutate(total = white + black_free + black_slaves) %>%
  mutate(prop_white = white/total, prop_black_free = black_free/total, prop_black_slave = black_slaves/total)
  

# Regions
S <- census_tidy %>% 
  filter(region == "South") %>% 
  group_by(region, year) %>% 
  ggplot(aes(x = year))+
  geom_line(aes(y = prop_black_slave, color = "black_slaves"), size = 1)+
  geom_line(aes(y = prop_white, color = "white"), size = 1)+
  geom_line(aes(y = prop_black_free, color = "black_free"), size = 1)+
  ggtitle("South")+
  ylab("Proportion")+
  scale_color_manual(values = c('black_slaves'='black','white'='red', "black_free" = "green"))+
  labs(color = "category")+
  ylim(0, 1)+
  theme_minimal()

N <- census_tidy %>% 
  filter(region == "Northeast") %>% 
  group_by(region, year) %>% 
  ggplot(aes(x = year))+
  geom_line(aes(y = prop_black_slave, color = "black_slaves"), size = 1)+
  geom_line(aes(y = prop_white, color = "white"), size = 1)+
  geom_line(aes(y = prop_black_free, color = "black_free"), size = 1)+
  ggtitle("Northeast")+
  ylab("Proportion")+
  scale_color_manual(values = c('black_slaves'='black','white'='red', "black_free" = "green"))+
  ylim(0,1)+
  labs(color = "category")+
  theme_minimal()

M <- census_tidy %>% 
  filter(region == "Midwest") %>% 
  group_by(region, year) %>% 
  ggplot(aes(x = year))+
  geom_line(aes(y = prop_black_slave, color = "black_slaves"), size = 1)+
  geom_line(aes(y = prop_white, color = "white"), size = 1)+
  geom_line(aes(y = prop_black_free, color = "black_free"), size = 1)+
  ggtitle("Midwest")+
  ylab("Proportion")+
   scale_color_manual(values = c('black_slaves'='black','white'='red', "black_free" = "green"))+
  ylim(0,1)+
  labs(color = "category")+
  theme_minimal()


W <- census_tidy %>% 
  filter(region == "West") %>% 
  group_by(region, year) %>% 
  ggplot(aes(x = year))+
  geom_line(aes(y = prop_black_slave, color = "black_slaves"), size = 1)+
  geom_line(aes(y = prop_white, color = "white"), size = 1)+
  geom_line(aes(y = prop_black_free, color = "black_free"), size = 1)+
  ggtitle("West")+
  ylab("Proportion")+
  scale_color_manual(values = c('black_slaves'='black','white'='red', "black_free" = "green"))+
  scale_y_continuous(limits = c(0,1))+
  labs(color = "category")+
  theme_minimal()

# west only has two years (1860, 1850)

```

```{r compare-region, fig.cap= "Composition of White and Black", fig.align="center", out.height="60%", out.width="60%", echo = FALSE}

ggarrange(N, M, S, W,
          ncol = 2, nrow = 2, common.legend = TRUE, legend = "bottom")
```

For answering the question of which region that most exploits the slavery practice, we will not look at the number of black slaves in each region of the USA. Instead, we will see the trend proportion of these three categories (white, black slaves, and black free), as seen in figure \@ref(fig:compare-region).

Seeing the plot, we can easily spot that **South region** has the most contrast pattern which distinguish the region from the others. The proportion of white people in South region slightly decrease from 1800 until 1860, however the proportion of black slaves is growing and comprises more than a quarter of the total population in that region.

```{r south_div, echo = FALSE, include = FALSE, results = "hide", message = FALSE}

# Look further in south

census_south <- census %>% 
  filter(region == "South", year != 1870) %>% 
  na.omit() %>% 
  mutate(total = white + black_free + black_slaves) %>%
  mutate(prop_white = white/total, prop_black_free = black_free/total, prop_black_slave = black_slaves/total)

SA <- census_south %>% 
  filter(year != 1870, division == "South Atlantic") %>% 
  ggplot(aes(x = year))+
  geom_line(aes(y = prop_black_slave), size = 1)+
  geom_line(aes(y = prop_white), color = "red", size = 1)+
  geom_line(aes(y = prop_black_free), color = "green", size = 1)+
  ggtitle("South Atlantic")+
  ylab("Proportion")+
  theme_minimal()

SA

ES <- census_south %>% 
  filter(year != 1870, division == "East South Central") %>% 
  ggplot(aes(x = year))+
  geom_line(aes(y = prop_black_slave), size = 1)+
  geom_line(aes(y = prop_white), color = "red", size = 1)+
  geom_line(aes(y = prop_black_free), color = "green", size = 1)+
  ggtitle("East South Central")+
  ylab("Proportion")+
  theme_minimal()
ES

WS <- census_south %>% 
  filter(year != 1870, division == "West South Central") %>% 
  ggplot(aes(x = year))+
  geom_line(aes(y = prop_black_slave), size = 1)+
  geom_line(aes(y = prop_white), color = "red", size = 1)+
  geom_line(aes(y = prop_black_free), color = "green", size = 1)+
  ggtitle("West South Central")+
  ylab("Proportion")+
  xlab("Census Year")+
  theme_minimal()
WS
```

```{r south-all, fig.cap= "Proportion of White and Black", fig.align="center", out.height="60%", out.width="60%", echo = FALSE, message = FALSE}

ggarrange(SA, ES, WS,
          ncol = 1, nrow = 3, legend = "top", common.legend = TRUE)
```

After spotting the pattern, we are interested to explore further in the South region to see the slavery practice in division level. South region consists of three divisions, South Atlantic, East South Central and West South Central.
From figure \@ref(fig:south-all) we can see clearly that East South Central division has more progressive pattern of exploitation during the observed period, where other divisions tend to have more stable pattern of slavery practice. However, all of these divisions have quite similar proportion of black slaves in the last census year of slavery period (1860). 

## The most unfriendly region for African-Americans

In this section, we will connect the past and post-slavery period in the USA through some observed events from blackpast data set. For the purpose, we will first filter country of interest in the data set to be only the USA. Later on, we will select only important words (filtered using English stop words of tidytext R package (@tidytext)). Having all essential words, we will try to find various sentiments in these words by using NRC sentiment of @nrc and grouping it by region. 

In order to link this analysis with the previous section, we add variable of regions that correspond to the state names in the blackpast data set. For example, we add Northeast for covering states like Connecticut, New York and New Jersey. In addition we also focus on all events that related to slavery and racism behavior toward African-American, by only selecting relevant subject such as **"Slave Laws", "Slave Labor", "Racial Restrictions", "Racial Violence","Resistance to Enslavement", "The Slavery Controversy", and "Antebellum Slavery")**. 

```{r event, echo = FALSE, include = FALSE,  results="hide", message = FALSE}
# select bad events in the US black history
# we assign corresponding regions to each state so we can check our previous exploration in most exploiting regions
blackpast_usa <- blackpast %>% 
  filter(country == "United States") %>% 
  filter(subject %in% c("Slave Laws", "Slave Labor", "Racial Restrictions",
          "Racial Violence","Resistance to Enslavement",
          "The Slavery Controversy","Antebellum Slavery")) %>%       
  mutate(region = case_when(
        state %in% c("Connecticut", "Maine", "Massachusetts", "New Hampshire", "Rhode Island", "Vermont", "New York", "New Jersey", "Pennsylvania") ~ "Northeast",
        state %in% c("Illinois", "Indiana", "Michigan", "Ohio", "Wisconsin", "Iowa", "Kansas", "Minnesota", "Missouri", "Nebraska", "North Dakota", "South Dakota") ~ "Midwest",
        state %in% c() ~ "",
        state %in% c("Delaware", "Florida", "Georgia", "Maryland", "North Carolina", "South Carolina", "Virginia", "District of Columbia", "West Virginia", "Alabama", "Kentucky", "Mississippi", "Tennessee", "Arkansas", "Louisiana", "Oklahoma", "Texas") ~ "South",
        state %in% c("Arizona", "Colorado", "Idaho", "Montana", "Nevada", "New Mexico", "Utah", "Wyoming", "Alaska", "California", "Hawaii", "Oregon", "Washington") ~ "West",
              ))

```

```{r sentiment, echo = FALSE, message = FALSE}

# using nrc package for analyse negative sentiment
nrc_sentiments <- get_sentiments("nrc") %>% 
  filter(sentiment %in% c("trust", "fear", "anger", "negative"))

text_blackpast <- blackpast_usa %>% 
  select(events, region) %>% 
  ungroup() %>% 
  unnest_tokens(input = "events", token = "words", "word")

# remove unnecessary words
data("stop_words")

text_tidy <- text_blackpast %>% 
  anti_join(stop_words)

text_tidy <- left_join(text_tidy, nrc_sentiments) %>% 
  na.omit()

# # removing word white, black, police, church, mob
# neutral <- c("white", "black", "police", "church", "mob")
# 
# # text_tidy <- text_tidy %>% 
# #   count(word, sort = TRUE) %>%
# #   filter(n > 10) %>%
# #   filter(!word %in% neutral) %>% 
# #   mutate(word = reorder(word, n)) %>%
# #   ggplot(aes(sentiment, n)) +
# #   geom_col() +
# #   xlab(NULL) +
# #   coord_flip()
# 
# plot_sentiment <- text_tidy %>% 
#   count(sentiment, sort = TRUE) %>%
#   filter(n > 1) %>%
#   mutate(sentiment = reorder(sentiment, n)) %>%
#   ggplot(aes(x = sentiment, y = n)) +
#   geom_col() +
#   xlab(NULL) +
#   coord_flip()
# 
# plot_sentiment


```

```{r sentiment_region, fig.cap = "Sentiment Analysis in Regions", echo = FALSE, message = FALSE, fig.align="center", out.width= "60%"}
text_tidy %>% 
  ggplot(aes(x = sentiment, y = word, fill= region, group = region)) +
  geom_col() +
  xlab("") +
  ylab("")+
  coord_flip()+
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())

```

```{r sentiment_negative, fig.cap = "Negative Nuances", out.width="50%", fig.align="center", echo = FALSE, message = FALSE}

# only bad sentiment analysed
text_tidy %>% 
  filter(sentiment %in% c("negative", "fear", "disgust", "sadness")) %>% 
  ggplot(aes(x = region, y = word, fill = sentiment, group = sentiment)) +
  geom_col() +
  xlab("") +
  ylab("")+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

```


Using these method, we can observe occurences of bad event for African-American in the data set which mostly comprises of racial restrictions and racial violence. According to the analysis in figure \@ref(fig:sentiment_region), most nuance of observed events are filled with **negative, fear and anger**. Moreover, most events recorded were occurred in South region. It is not surprising given the previous finding that South region is the region that seems really exploiting slavery practice. 

We then focus on particular bad events which represented by sentiment of "disgust", "fear", "negative" and "sadness" and plot it into bar chart as seen in figure \@ref(fig:sentiment_negative). Using these sentiments, we can see that South and Northeast region are seems like "unfriendly" to the African-American people since both regions contribute to most of these bad events in the observed data. On the other hand, **West region** maybe a good place to live for African-American, due to very few bad incidents happened there.

## Summary

The history of slavery has deeply rooted in some parts of the USA, and the practice was mostly exploited in the South region following our exploration in the second section. The slaves were brought into the country mainly for being a worker, therefore most slaves were in their productive ages, ranges from 15 to 35 years old. 

According to sentiment analysis from blackpast record of events, we can see that most bad events took place in **South region** followed by **Northeast region**. These bad events are related to slavery and racism behavior (post-slavery) toward Africa-American.

This finding is quite intriguing since it is inadvertently backed by a journal research from @journal that describes these two regions as the most racist regions in the United States. 

# Bibliography
